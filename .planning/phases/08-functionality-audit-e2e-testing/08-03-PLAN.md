---
phase: 08-functionality-audit-e2e-testing
plan: 03
type: execute
depends_on: ["08-01"]
files_modified: [e2e/subscriptions.spec.ts, e2e/subscriptions-manage.spec.ts, e2e/checkout.spec.ts]
---

<objective>
Write E2E tests for Subscription management, pricing administration, and the public checkout flow.

Purpose: Validate the billing and subscription modules that are critical for gym revenue.
Output: Passing E2E test suites for subscriptions, pricing admin, and checkout.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-functionality-audit-e2e-testing/08-01-SUMMARY.md
@.planning/phases/05-subscriptions-billing-audit/05-01-SUMMARY.md
@.planning/phases/05-subscriptions-billing-audit/05-03-SUMMARY.md

# Key source files:
@src/pages/Subscriptions.tsx
@src/pages/SubscriptionsManage.tsx
@src/pages/checkout/PlansOverview.tsx
@src/pages/checkout/PlanCheckout.tsx
@src/hooks/useSubscriptions.ts

**Constraining decisions:**
- Phase 5: Subscription cancel/freeze/unfreeze with confirmation dialogs
- Phase 5: Pricing matrix duplicate detection via PostgreSQL 23505 error
- Phase 5: Cascade delete warnings for age_groups and plan_types
- Mollie is payment provider (don't test actual payment — just form validation)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write E2E tests for Subscriptions page</name>
  <files>e2e/subscriptions.spec.ts</files>
  <action>
Write `e2e/subscriptions.spec.ts` with `test.describe('Subscriptions')`:

Setup: `test.beforeEach` — login as admin, navigate to /subscriptions.

Test cases:
1. **"should display subscriptions list"** — expect table/list with subscription rows or empty state
2. **"should filter by status"** — use status filter (active, cancelled, expired, frozen), verify results change
3. **"should search by member name"** — type in search, expect filtered results
4. **"should show subscription statistics"** — expect stats cards visible (active count, MRR, etc.)
5. **"should navigate to member from subscription"** — click member name/link, expect navigation to member detail

NOTE: Do NOT test cancel/freeze/unfreeze on real subscriptions — too destructive. These actions were already code-audited in Phase 5. Just verify the buttons are present and confirmation dialogs appear when clicked (then cancel the dialog).

6. **"should show cancel confirmation dialog"** — if an active subscription exists, click cancel button, expect confirmation dialog, then click "Annuleer" to dismiss
  </action>
  <verify>`npx playwright test e2e/subscriptions.spec.ts` passes.</verify>
  <done>Subscriptions spec has 6+ test cases covering list display, filters, search, stats, and action dialogs.</done>
</task>

<task type="auto">
  <name>Task 2: Write E2E tests for SubscriptionsManage pricing admin</name>
  <files>e2e/subscriptions-manage.spec.ts</files>
  <action>
Write `e2e/subscriptions-manage.spec.ts` with `test.describe('Subscriptions Management')`:

Setup: `test.beforeEach` — login as admin, navigate to /subscriptions/manage.

Test cases:
1. **"should display pricing management tabs"** — expect tabs for age groups, plan types, pricing matrix (or similar structure)
2. **"should show existing age groups"** — expect at least one age group listed (Reconnect seed data)
3. **"should show existing plan types"** — expect at least one plan type listed
4. **"should show pricing matrix"** — expect pricing entries with price, duration visible
5. **"should open add age group form"** — click add button, expect form with name field
6. **"should validate pricing form"** — try submitting empty pricing entry, expect validation error
7. **"should show one-time products section"** — expect section for day passes, trial classes if present
8. **"should show discount/add-on sections"** — expect insurance, equipment rental sections if present

NOTE: Do NOT create/delete real pricing data — verify UI rendering and form validation only. Any CRUD tests should use obviously fake data and clean up after.
  </action>
  <verify>`npx playwright test e2e/subscriptions-manage.spec.ts` passes.</verify>
  <done>SubscriptionsManage spec has 8+ test cases covering pricing admin UI, form validation, and data display.</done>
</task>

<task type="auto">
  <name>Task 3: Write E2E tests for public checkout flow</name>
  <files>e2e/checkout.spec.ts</files>
  <action>
Write `e2e/checkout.spec.ts` with `test.describe('Checkout Flow')`:

NO login required — these are public pages.

Test cases:
1. **"should display plans overview page"** — navigate to /checkout/plans, expect age group selection or plan cards visible
2. **"should show plans for age group"** — click an age group, expect plan cards with prices
3. **"should navigate to plan checkout"** — click a plan, navigate to /checkout/plans/:ageGroup, expect checkout form
4. **"should show checkout form fields"** — expect first name, last name, email, phone fields, plan details summary
5. **"should validate required fields"** — submit empty form, expect validation errors on required fields
6. **"should show plan pricing summary"** — expect selected plan name, price, duration visible in checkout summary

NOTE: Do NOT submit actual checkout — would trigger Mollie payment. Stop at form validation. The payment flow was hardened in Phase 5.
  </action>
  <verify>`npx playwright test e2e/checkout.spec.ts` passes.</verify>
  <done>Checkout spec has 6+ test cases covering public plan browsing, form display, and validation. No actual payments triggered.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx playwright test e2e/subscriptions.spec.ts` passes
- [ ] `npx playwright test e2e/subscriptions-manage.spec.ts` passes
- [ ] `npx playwright test e2e/checkout.spec.ts` passes
- [ ] No destructive actions on real data
- [ ] All tests respect existing data (read-only where possible)
</verification>

<success_criteria>

- All 3 spec files written and passing
- 20+ E2E test cases for billing and checkout modules
- Destructive actions verified via dialog appearance only (not execution)
- Public checkout tested without triggering payments
</success_criteria>

<output>
After completion, create `.planning/phases/08-functionality-audit-e2e-testing/08-03-SUMMARY.md`
</output>
